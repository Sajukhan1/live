<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube Region Checker</title>
  <style>
    body {
      background: #121212;
      color: #eee;
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      font-size: 16px;
    }
    button {
      background: #ff0000;
      border: none;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background: #cc0000;
    }
    .result {
      margin-top: 20px;
      background: #282828;
      padding: 15px;
      border-radius: 6px;
    }
    .allowed {
      color: #0f0;
    }
    .blocked {
      color: #f33;
    }
  </style>
</head>
<body>

<h2>YouTube Video Region Restriction Checker</h2>
<input type="text" id="videoIdInput" placeholder="Enter YouTube Video ID (e.g. 5To0cZTC-rU)" />
<button id="checkBtn">Check Restrictions</button>

<div id="result" class="result" style="display:none;"></div>

<script>
  const accessToken = localStorage.getItem("access_token");

  if (!accessToken) {
    alert("Access token not found. Please log in from index.html first.");
  }

  document.getElementById('checkBtn').addEventListener('click', () => {
    const videoId = document.getElementById('videoIdInput').value.trim();
    if (!videoId) {
      alert('Please enter a YouTube video ID.');
      return;
    }
    checkRegionRestrictions(videoId);
  });

  function checkRegionRestrictions(videoId) {
    const url = `https://www.googleapis.com/youtube/v3/videos?part=contentDetails,snippet&id=${videoId}`;

    fetch(url, {
      headers: {
        Authorization: "Bearer " + accessToken
      }
    })
    .then(res => res.json())
    .then(data => {
      if (!data.items || data.items.length === 0) {
        showResult("❌ No video found with this ID or it is private.");
        return;
      }

      const video = data.items[0];
      const title = video.snippet.title;
      const regionRestriction = video.contentDetails.regionRestriction || {};
      const allowed = regionRestriction.allowed || [];
      const blocked = regionRestriction.blocked || [];

      let html = `<h3>Title: ${title}</h3>`;

      if (allowed.length > 0) {
        html += `<p class="allowed"><strong>Allowed Countries:</strong> ${allowed.join(", ")}</p>`;
        html += `<p class="blocked">All others are blocked.</p>`;
      } else if (blocked.length > 0) {
        html += `<p class="blocked"><strong>Blocked Countries:</strong> ${blocked.join(", ")}</p>`;
        html += `<p class="allowed">All others are allowed.</p>`;
      } else {
        html += `<p>No region restriction found. Video is globally available.</p>`;
      }

      showResult(html);
    })
    .catch(err => {
      console.error(err);
      showResult("❌ Error fetching video details.");
    });
  }

  function showResult(html) {
    const resultDiv = document.getElementById('result');
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = html;
  }
</script>

</body>
</html>
